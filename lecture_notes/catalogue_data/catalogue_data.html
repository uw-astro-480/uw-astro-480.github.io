<!doctype html>
<html class="no-js" lang="en" data-content_root="../../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="../../genindex.html" /><link rel="search" title="Search" href="../../search.html" /><link rel="next" title="Plotting and data visualisation" href="../data_visualisation/data_visualisation.html" /><link rel="prev" title="Photometry and CCD calibrations" href="../photometry/photometry.html" />

    <link rel="shortcut icon" href="../../_static/favicon.ico"/><!-- Generated with Sphinx 8.2.3 and Furo 2024.08.06 -->
        <title>Catalogue data and SQL - ASTR 480</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo-extensions.css?v=302659d7" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles.css?v=2bccd5c4" />
    
    


<style>
  body {
    --color-code-background: #eeffcc;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #242933;
  --color-code-foreground: #d8dee9;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #242933;
  --color-code-foreground: #d8dee9;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../index.html"><div class="brand">ASTR 480</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="../../_static/UW_logo.png" alt="Logo"/>
  </div>
  
  
</a><form class="sidebar-search-container" method="get" action="../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Resources</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../syllabus.html">Course description</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../schedule.html">Schedule</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1 current has-children"><a class="reference internal" href="../lecture_notes.html">Lecture notes</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Lecture notes</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../intro_concepts/intro_concepts.html">Introductory concepts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ccds/ccds.html">CCDs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ccd_reductions/ccd_reductions.html">Basic CCD reductions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../photometry/photometry.html">Photometry and CCD calibrations</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Catalogue data and SQL</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data_visualisation/data_visualisation.html">Plotting and data visualisation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../spectrographs/spectrographs.html">Spectrographs</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../arcsat/arcsat.html">ARCSAT observations</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of ARCSAT observations</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../arcsat/proposals.html">ARCSAT proposals</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../arcsat/observing.html">ARCSAT observing and schedule</a></li>
<li class="toctree-l2"><a class="reference external" href="https://www.apo.nmsu.edu/Telescopes/ARCSAT/" rel="noreferrer" target="_blank">ARCSAT documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../arcsat/paper.html">ARCSAT paper</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../assignments/assignments.html">Assignments</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of Assignments</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../assignments/assignment_0/assignment_0.html">Assignment 0: testing the coding environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../assignments/assignment_1/assignment_1.html">Assignment 1: coordinate transformations and altitude plotting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../assignments/assignment_2/assignment_2.html">Assignment 2: CCD reductions and photometry</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../assignments/assignment_3/assignment_3.html">Assignment 3: tabular data and data visualisation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../assignments/assignment_4/assignment_4.html">Assignment 4 (extra credit): spectroscopic data reduction</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../codedev/codedev.html">Code development and tools</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of Code development and tools</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../codedev/setup.html">Setting up the development environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../codedev/visualisation_tools.html">Visualisation tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../codedev/plotting.html">Plotting</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../faq.html">Frequently Asked Questions</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Links</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://github.com/uw-astro-480" rel="noreferrer" target="_blank">GitHub</a></li>
<li class="toctree-l1"><a class="reference external" href="https://jupyter.rttl.uw.edu/2025-spring-astr-480-a" rel="noreferrer" target="_blank">JupyterHub</a></li>
<li class="toctree-l1"><a class="reference external" href="https://canvas.uw.edu/courses/1799617" rel="noreferrer" target="_blank">Canvas</a></li>
<li class="toctree-l1"><a class="reference external" href="https://www.apo.nmsu.edu/Telescopes/ARCSAT/" rel="noreferrer" target="_blank">ARCSAT</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="https://github.com/astr-480/astr-480-sp-25/blob/main/src/lecture_notes/catalogue_data/catalogue_data.md?plain=true" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div><div class="edit-this-page">
  <a class="muted-link" href="https://github.com/astr-480/astr-480-sp-25/edit/main/src/lecture_notes/catalogue_data/catalogue_data.md" title="Edit this page">
    <svg><use href="#svg-pencil"></use></svg>
    <span class="visually-hidden">Edit this page</span>
  </a>
</div><div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section class="tex2jax_ignore mathjax_ignore" id="catalogue-data-and-sql">
<h1>Catalogue data and SQL<a class="headerlink" href="#catalogue-data-and-sql" title="Link to this heading">¶</a></h1>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>This sections is a work in progress. New content will be added shortly.</p>
</div>
<div class="note docutils">
<p>You can download this lecture as <a class="reference download internal" download="" href="../../_downloads/55c06795e23c8047b9701c3e78651753/catalogue_data.ipynb"><code class="xref download myst-nb docutils literal notranslate"><span class="pre">catalogue_data.ipynb</span></code></a> or <a class="reference download internal" download="" href="../../_downloads/081a6b895ef727de2a80c344014b54d5/catalogue_data.md"><code class="xref download docutils literal notranslate"><span class="pre">catalogue_data.md</span></code></a> and follow along. The datasets for these examples can be found <a class="reference external" href="https://faculty.washington.edu/gallegoj/astr480/tables.tar.bz2" rel="noreferrer" target="_blank">here</a>.</p>
</div>
<p>Tabular data (or catalogues, we’ll use these terms interchangeably in this section) is everywhere in observational astronomy and it has become even more relevant with the advent of large, all-sky survey and large datasets. After we have reduced and processed CCD data, it is often the case that we extract information from the different sources on the image (e.g., coordinates, magnitudes, or other derived properties like spectral line ratios) and organise them as a table of values. In modern astronomy those tables can sometimes be very large (millions or even billions or rows and tens of columns), which makes handling them efficiently even more critical.</p>
<p>In this section we’ll discuss what tables are, how to organise your data correctly, and how to perform basic operation on tabular data. We will also introduce SQL and see how to query some of the most popular astronomical databases.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This section is not meant to be a comprehensive guide to all the features that you may need from tools like <code class="docutils literal notranslate"><span class="pre">astropy.table</span></code>, <code class="docutils literal notranslate"><span class="pre">polars</span></code>, or <code class="docutils literal notranslate"><span class="pre">pandas</span></code>. It is means to give you a basic understanding of how to work with tabular data and how to use SQL to query databases. For more information you should refer to the documentation of the libraries you are using and the further reading at the end of this section.</p>
</div>
<section id="what-is-a-table">
<h2>What is a table?<a class="headerlink" href="#what-is-a-table" title="Link to this heading">¶</a></h2>
<p>We all intuitively understand what a “table” is, but let’s start with some basic definitions of what we mean with tabular data from the point of view of data science:</p>
<ul class="simple">
<li><p>A <strong>dataset</strong> is a collection of values. Each value is associated with a data type (string, number, boolean, etc.)</p></li>
<li><p>A <strong>variable</strong> contains all the values that measured the same underlying attribute.</p></li>
<li><p>An <strong>observation</strong> contains all the values measured on the same unit.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>These definitions and much of the content of this section is based on the <a class="reference external" href="https://vita.had.co.nz/papers/tidy-data.pdf" rel="noreferrer" target="_blank">Tidy data</a> paper by Hadley Wickham. This paper is a great introduction to the concept of tidy data and recommended reading for anyone working in data science.</p>
</div>
<p>Let’s put this in perspective with two examples that display the same data in different formats. In both cases we have a dataset of patients that have been administered two treatments (A and B) and we have measured a parameter (e.g., blood pressure) after the treatment.</p>
<p><a class="reference internal" href="../../_images/patients-a.png"><img alt="Table A" class="align-center" src="../../_images/patients-a.png" style="width: 60%;" /></a></p>
<p><a class="reference internal" href="../../_images/patients-b.png"><img alt="Table B" class="align-center" src="../../_images/patients-b.png" style="width: 60%;" /></a></p>
<p>What is a variable and what an observation in these two tables? The most natural way of looking at this data is that each observation correspond to a different patient and there are three associated variables: the name of the patient, the treatment that has been administered, and the result measured.</p>
<p>It’s clear that these two tables convey the same information, but is there one way that is better? Actually neither of these structures is ideal. To organise the data in what can be called a “tidy” manner we want to follow these three rules (Codd’s 3rd normal form; Codd 1990):</p>
<ol class="arabic simple">
<li><p>Each variable forms a column.</p></li>
<li><p>Each observation forms a row.</p></li>
<li><p>Each type of observational unit forms a table.</p></li>
</ol>
<p>If we look at our previous two tables we’ll see them completely follows the first two rules. The first table follows the second row (each observation –a patient– forms a row) but not the first one (each treatment is associated with a column). The second table does not follow either of the rules. Instead, let’s reorganise the data in a tidy manner:</p>
<p><a class="reference internal" href="../../_images/patients-tidy.png"><img alt="Table C" class="align-center" src="../../_images/patients-tidy.png" style="width: 40%;" /></a></p>
<p>Now each row is an observation (rule 2) and each column is one of the variable we identified earlier (rule 1). What about rule 3? Imagine that in addition to the name of the patient we have a long list of biographical and medical data for each patient (age, height, weight, medications taken, etc.) We could add all those variables to our table but it can be argued that they form its own type of data or unit. In that case it is better to have two different tables, one with the results to the treatment and one with the biographical data. These tables can be linked (or <em>joined</em> in database terminology) using the name of the patient as a common variable.</p>
<p>If these rules seem a bit subjective it is because to some extent they are. In some complicated cases it may not be easy to decide what is a variable and what is an observation, or how to separate different types of observational units. However, it is always useful to keep these rules in mind when deciding how to structure your data. A bad decision at an early stage can lead to a lot of wasted time when trying to analyse the data or, worse, to incorrect conclusions.</p>
<section id="data-types">
<h3>Data types<a class="headerlink" href="#data-types" title="Link to this heading">¶</a></h3>
<p>We briefly mentioned that each value in a dataset is associated with a data type. While this is not strictly true in all cases (as we’ll see when we talk about the CSV data format), most tabular formats define a data type for each column (or variable). The allowed data types depend on the format, but in general they are:</p>
<ul class="simple">
<li><p><em>Integers</em>. Natural numbers (0, 1, 2, …) or negative integers (-1, -2, …). The range of the integers that we can store depends on the type. For example, unsigned 16-bit integers (<code class="docutils literal notranslate"><span class="pre">uint16</span></code> or sometimes <code class="docutils literal notranslate"><span class="pre">uint2</span></code>) accept only positive integers from 0 to <span class="math notranslate nohighlight">\(2^{16}-1\)</span> or 0 to 65535. Signed 16-bit integers (<code class="docutils literal notranslate"><span class="pre">int16</span></code>) accept positive and negative integers from <span class="math notranslate nohighlight">\(-2^{15}\)</span> to <span class="math notranslate nohighlight">\(2^{15}-1\)</span> or -32768 to 32767. The same can be said for 32-bit and 64-bit (unsigned) integers. When not explicitly specified many libraries will default to 64-bit integers because they are the most general, but they are also the most memory consuming. For large datasets it can make a very significant difference to use a smaller type when possible.</p></li>
<li><p><em>Floating point numbers</em>. Real numbers (e.g., 1.0, 2.5, -3.14, etc.). The same as for integers, the range and precision of the floating point numbers that we can store depends on the type, but in this case also of the computer architecture and (in some cases) the programming language. For most normal situations <code class="docutils literal notranslate"><span class="pre">float32</span></code> is sufficient but for some situations (e.g., coordinates expressed in degrees where we want sub-arcsec precision) we may want to use <code class="docutils literal notranslate"><span class="pre">float64</span></code>.</p></li>
<li><p><em>Strings</em>. Text data. Strings are usually stored as arrays of characters. Each character may be an ASCII code (essentially a number between 0 and 255, or 8 bits) or a Unicode code (a different encoding system with variable data size per character –although the concept of character is not straightforward in Unicode– that includes many more symbols like non-latin alphabets or emojis).</p></li>
<li><p><em>Booleans</em>. Logical values. Usually represented as 0 (False) and 1 (True). In some programming languages they are represented as <code class="docutils literal notranslate"><span class="pre">true</span></code> and <code class="docutils literal notranslate"><span class="pre">false</span></code> or <code class="docutils literal notranslate"><span class="pre">yes</span></code> and <code class="docutils literal notranslate"><span class="pre">no</span></code>.</p></li>
<li><p><em>Dates and times</em>. Dates and times are usually stored as a number of seconds or milliseconds since a reference date (e.g., 1970-01-01T00:00:00 UTC, also known as the Unix epoch). Note that there is a difference between storing a date as a string (e.g., “2023-10-01T12:00:00”) and as a datetime object, which are usually just floating point numbers underneath and thus stored and queried more efficiently.</p></li>
<li><p><em>Lists</em>, <em>arrays</em>, or <em>mappings</em>. These are the equivalents of lists and dictionaries in Python. They are not supported by many tabular formats. Usually a list allows to specify a variable number of values for each observation while the values for an array type must always have the same length.</p></li>
<li><p><em>Missing values/nulls</em>. While not exactly a data type, it is often critical to be able to represent missing or inexistent values in a dataset. For example, in our patient example John Smith had not been administered treatment A. How a data format handles missing values (assuming it can) changes, with some formats using a special value (e.g., <code class="docutils literal notranslate"><span class="pre">NaN</span></code> or <code class="docutils literal notranslate"><span class="pre">null</span></code>) and others using a special type (e.g., <code class="docutils literal notranslate"><span class="pre">None</span></code> in Python). Some formats do not support missing values at all; in those cases we often need to replace the missing values with a filler value that we have agreed represents missing data (e.g., -999).</p></li>
</ul>
</section>
<section id="tabular-data-formats">
<h3>Tabular data formats<a class="headerlink" href="#tabular-data-formats" title="Link to this heading">¶</a></h3>
<p>While the concept of table is simple, the details of how to store and query tabular data can be quite complex. Because of this, there exist hundreds of different tabular data formats (here format means both the file format to which the data is saved and the data structure used to store it in memory). Some of the most common formats are:</p>
<ul class="simple">
<li><p><em>CSV (Comma Separated Values)</em>. A simple text format where each line corresponds to a row in the table and the values are separated by commas. The first line usually contains the names of the columns and comments can be preceded by a <code class="docutils literal notranslate"><span class="pre">#</span></code>. CSV files are very common because they are easy to read and write, but they have some important limitations: they do not support data types (everything is stored as strings which means the library reading them needs to make assumptions about the type to which to cast the column), they are stored as plain-text ASCII files (which is convenient for editing but inefficient in terms of storage), and they are not memory efficient.</p></li>
<li><p><em>FITS (Flexible Image Transport System)</em>. In addition to storing array data (images) FITS files can also include extensions with tabular data in binary format (this means that data is not stored as plain-text ASCII). FITS files are very common in astronomy but are less efficient than other formats and can only be read by a few libraries.</p></li>
<li><p><em>HDF5 (Hierarchical Data Format version 5)</em>. A binary format used to store large amounts of data. HDF5 files are very efficient in terms of storage and allow to store metadata and missing values. They are not as common as FITS files in astronomy but they are widely used in other fields (e.g., machine learning).</p></li>
<li><p><em>Parquet</em>. A columnar binary format that is very efficient in terms of storage and allows for complex data types and missing values. It is the main format used by the Apache Arrow and Spark projects and is widely used in data science and machine learning.</p></li>
</ul>
<p>Additionally, many services and projects (VOTable, CDS, SDSS, etc.) have defined their own tabular formats, usually as plain-text ASCII files. <code class="docutils literal notranslate"><span class="pre">astropy.io.ascii</span></code> and <code class="docutils literal notranslate"><span class="pre">astropy.table</span></code> can read and write many of these formats.</p>
<p>Tabular data formats generally need to make a decision on how to store data both in memory and on disk. There are two main options: data can be stored in a row-oriented format (e.g., CSV, FITS) or in a column-oriented format (where each column is stored together, for example Parquet). Each approach has its advantages and disadvantages. Row-oriented formats are faster to retrieve a single row of data since we know where that row is stored in the file and we can retrieve it without having to read the entire file. But if we are interested in only a few columns of a large table, a row-oriented format is less efficient as it will need to read the entire file and then discard the columns we are not interested in. In contrast, a column-oriented format allows us to retrieve only the columns we need. Some format like HDF5 allow to store data in both formats but with some drawbacks.</p>
</section>
</section>
<section id="working-with-tabular-data">
<h2>Working with tabular data<a class="headerlink" href="#working-with-tabular-data" title="Link to this heading">¶</a></h2>
<p>Now that we know what a table is in theory, let’s look at some examples of tables and table formats. We’ll start with a very simple file in CSV format. The <code class="docutils literal notranslate"><span class="pre">sdss_i.csv</span></code> file contains the throughput for the SDSS i-band filter at different wavelengths. Let’s look at the first few lines of the file:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>head<span class="w"> </span>-20<span class="w"> </span>sdss_i.csv
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span># WAVELENGTH_UNIT	AA
# COMPNAME       	SDSS_i
# NAME           	SDSS_i
# DETECTOR       	photon
#
## WAVELENGTH	None	AA
## THROUGHPUT	None	filter throughput definition
#
WAVELENGTH,THROUGHPUT
6430.000000,0.000000
6455.000000,0.000100
6480.000000,0.000300
6505.000000,0.000400
6530.000000,0.000400
6555.000000,0.000300
6580.000000,0.000300
6605.000000,0.000400
6630.000000,0.000900
6655.000000,0.001900
6680.000000,0.003400
</pre></div>
</div>
</div>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>The <code class="docutils literal notranslate"><span class="pre">!</span></code> at beginning of these commands is necessary because the code in this page is running in a Jupyter notebook. If you are running these examples in a Linux terminal you must remove the <code class="docutils literal notranslate"><span class="pre">!</span></code>.</p>
</div>
<p>The file contains a few comments prefixed by a <code class="docutils literal notranslate"><span class="pre">#</span></code> character. Then the first real line includes the names of the columns (<code class="docutils literal notranslate"><span class="pre">WAVELENGTH</span></code> and <code class="docutils literal notranslate"><span class="pre">THROUGHPUT</span></code>) with a comma separating them. The rest of the lines contain the values for each column.</p>
<p>There are many tools to read and write CSV files in Python (including a <a class="reference external" href="https://docs.python.org/3/library/csv.html" rel="noreferrer" target="_blank">standard library</a> module or astropy). We will use the <a class="reference external" href="https://pola.rs/" rel="noreferrer" target="_blank">polars</a> library but everything here can be done using <a class="reference external" href="https://pandas.pydata.org/" rel="noreferrer" target="_blank">pandas</a> for those who prefer it. Both libraries are very similar but the syntax is somewhat different. Polars is a more efficient library and works better with the Apache Arrow formats, although Pandas is similarly efficient for most operations.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">polars</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">polars</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;sdss_i.csv&#39;</span><span class="p">,</span> <span class="n">comment_prefix</span><span class="o">=</span><span class="s1">&#39;#&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;# lines:&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>

<span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;WAVELENGTH&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;THROUGHPUT&#39;</span><span class="p">],</span> <span class="s1">&#39;r-&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span># lines: 89
shape: (5, 2)
┌────────────┬────────────┐
│ WAVELENGTH ┆ THROUGHPUT │
│ ---        ┆ ---        │
│ f64        ┆ f64        │
╞════════════╪════════════╡
│ 6430.0     ┆ 0.0        │
│ 6455.0     ┆ 0.0001     │
│ 6480.0     ┆ 0.0003     │
│ 6505.0     ┆ 0.0004     │
│ 6530.0     ┆ 0.0004     │
└────────────┴────────────┘
</pre></div>
</div>
<img alt="../../_images/2fcf64f99ce34179a7116192ee33927aa3af94d83fe7ed3e1f71ccae2669d8ee.png" src="../../_images/2fcf64f99ce34179a7116192ee33927aa3af94d83fe7ed3e1f71ccae2669d8ee.png" />
</div>
</div>
<p>The resulting structure is called a <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> and contains 89 rows and 2 columns. Note that Polars has inferred the data types of the columns and set them both to <code class="docutils literal notranslate"><span class="pre">float64</span></code>. This is probably excessive so let’s cast everything to <code class="docutils literal notranslate"><span class="pre">float32</span></code> just to see how to do it:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">polars</span><span class="o">.</span><span class="n">Float32</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">dtypes</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[Float32, Float32]
</pre></div>
</div>
</div>
</div>
<p>Given a dataframe there are a number of operations that we can perform on it (the nomenclature is not always the same so you may find different names for the same operation in different libraries):</p>
<ul class="simple">
<li><p><em>Selection</em>: select a subset of the columns of the dataframe. Sometimes this also applies to rows when we are selecting them based on indexing.</p></li>
<li><p><em>Filtering</em>: select a subset of the rows of the dataframe based on some condition. For example, we may want to select only the rows where the value of a column is greater than a certain value.</p></li>
<li><p><em>Aggregation</em>: combine the values of a column based on some condition. For example, we may want to calculate the mean value of a column for all the rows that satisfy a certain condition.</p></li>
<li><p><em>Sorting</em>: sort the rows of the dataframe based on the values of one or more columns.</p></li>
<li><p><em>Grouping</em>: group the rows of the dataframe based on the values of one or more columns. For each group we can then apply an aggregation function to calculate a summary statistic (e.g., mean, median, etc.)</p></li>
<li><p><em>Pivoting</em>: transform the dataframe from a long format to a wide format or vice versa.</p></li>
<li><p><em>Joining</em>: combine two dataframes based on the values of one or more columns.</p></li>
</ul>
<p>We will not explicitly try to cover all these operations here but we will see examples for many of them. Let’s start with a simple aggregation by calculate the mean wavelength and throughput:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>shape: (1, 2)
┌────────────┬────────────┐
│ WAVELENGTH ┆ THROUGHPUT │
│ ---        ┆ ---        │
│ f32        ┆ f32        │
╞════════════╪════════════╡
│ 7530.0     ┆ 0.19872    │
└────────────┴────────────┘
</pre></div>
</div>
</div>
</div>
<p>Note that the <code class="docutils literal notranslate"><span class="pre">mean()</span></code> operation, when applied to the entire dataframe, calculates the mean for each column. We can also calculate the mean for a single column by first selecting it using square brackets with the name of the column:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean throughput:&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;THROUGHPUT&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Mean throughput: 0.19872022421091726
</pre></div>
</div>
</div>
</div>
<p>Polars also provides a way to select a subset of columns using the <code class="docutils literal notranslate"><span class="pre">select()</span></code> method</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;WAVELENGTH&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>shape: (89, 1)
┌────────────┐
│ WAVELENGTH │
│ ---        │
│ f32        │
╞════════════╡
│ 6430.0     │
│ 6455.0     │
│ 6480.0     │
│ 6505.0     │
│ 6530.0     │
│ …          │
│ 8530.0     │
│ 8555.0     │
│ 8580.0     │
│ 8605.0     │
│ 8630.0     │
└────────────┘
</pre></div>
</div>
</div>
</div>
<p>We can apply a filter on the rows of the dataframe using the <code class="docutils literal notranslate"><span class="pre">filter()</span></code> method. For example, let’s select only the rows where the wave;ength is greater than 8000 Angstroms:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">polars</span><span class="o">.</span><span class="n">col</span><span class="o">.</span><span class="n">WAVELENGTH</span> <span class="o">&gt;</span> <span class="mi">8000</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>shape: (26, 2)
┌────────────┬────────────┐
│ WAVELENGTH ┆ THROUGHPUT │
│ ---        ┆ ---        │
│ f32        ┆ f32        │
╞════════════╪════════════╡
│ 8005.0     ┆ 0.2923     │
│ 8030.0     ┆ 0.2896     │
│ 8055.0     ┆ 0.284      │
│ 8080.0     ┆ 0.2758     │
│ 8105.0     ┆ 0.2642     │
│ …          ┆ …          │
│ 8530.0     ┆ 0.0009     │
│ 8555.0     ┆ 0.0008     │
│ 8580.0     ┆ 0.0005     │
│ 8605.0     ┆ 0.0002     │
│ 8630.0     ┆ 0.0        │
└────────────┴────────────┘
</pre></div>
</div>
</div>
</div>
<p>Polars uses a special syntax to refer to the columns of the dataframe. In this case we are using <code class="docutils literal notranslate"><span class="pre">polars.col.WAVELENGTH</span></code> to refer to the <code class="docutils literal notranslate"><span class="pre">WAVELENGTH</span></code> column. This is call an <em>expression</em> and internally Polars uses a query engine to evaluate the expression and apply it to the dataframe in the most efficient way.</p>
</section>
<section id="reading-and-converting-fits-files">
<h2>Reading and converting FITS files<a class="headerlink" href="#reading-and-converting-fits-files" title="Link to this heading">¶</a></h2>
<p>Let’s move to a more interesting example. The file <code class="docutils literal notranslate"><span class="pre">Kounkel_Clustering.fits</span></code> contains a catalogue of young stars in the Solar neighbourhood published in [Kounkel et al. (2019)(https://ui.adsabs.harvard.edu/abs/2019AJ….158..122K/abstract)] and selected from the <a class="reference external" href="https://www.cosmos.esa.int/web/gaia/dr2" rel="noreferrer" target="_blank">Gaia DR2</a> catalogue. The file is a FITS catalogue so we cannot read it directly with Polars or Pandas. Instead, we will use the <a class="reference external" href="https://docs.astropy.org/en/stable/table/" rel="noreferrer" target="_blank">astropy.table</a> module to read it.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">astropy.table</span><span class="w"> </span><span class="kn">import</span> <span class="n">Table</span>

<span class="n">table</span> <span class="o">=</span> <span class="n">Table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;Kounkel_Clustering.fits&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>     SOURCE_ID            2mass       ...        DIST             EDIST       
------------------- ----------------- ... ----------------- ------------------
2172342682494385024 21221732+5204385  ... 655.3072337333102 30.594480041462198
2170224782576556672 21023648+5212011  ... 655.3072337333102 30.594480041462198
2168760576695182208 21025198+5013440  ... 655.3072337333102 30.594480041462198
2168760439256230528 21030325+5013130  ... 655.3072337333102 30.594480041462198
2170222343035098880 21021934+5204460  ... 655.3072337333102 30.594480041462198
2168971717281204352 21011130+5037403  ... 655.3072337333102 30.594480041462198
2169491648838088064 21053520+5138262  ... 655.3072337333102 30.594480041462198
2168944744886766208 21020077+5019449  ... 655.3072337333102 30.594480041462198
2168967009997150720 21014403+5029231  ... 655.3072337333102 30.594480041462198
2176086004195127808 21191303+5345457  ... 655.3072337333102 30.594480041462198
                ...               ... ...               ...                ...
 533447277610484608 01061388+7102053  ... 1165.741720812367 39.611159308448954
 533260463713950464 01175989+7022358  ... 1165.741720812367 39.611159308448954
 533289875649839232 01210096+7034179  ... 1165.741720812367 39.611159308448954
 533297984547788672 01195371+7051469  ... 1165.741720812367 39.611159308448954
 533326709288605568 01134069+7040460  ... 1165.741720812367 39.611159308448954
 533346328699090432 01114949+7057228  ... 1165.741720812367 39.611159308448954
 533016818809105792 01032924+7008533  ... 1165.741720812367 39.611159308448954
 532824507352258560 01075216+6951473  ... 1165.741720812367 39.611159308448954
 532498777032261120 01221260+7004371  ... 1165.741720812367 39.611159308448954
 535655784151981696 01185344+7321178  ... 1165.741720812367 39.611159308448954
Length = 987376 rows
</pre></div>
</div>
</div>
</div>
<p>Astropy Table objects allows to perform many of the same operations that we saw before, such as filtering, selecting, or aggregation. You can read the documentation about how to do that, but in many cases it is similar to using Numpy on an array. Here we will just convert the table to a Polars dataframe; we just need to convert the table to a Numpy structure and then read it with Polars:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">polars</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">as_array</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>shape: (987_376, 18)
┌────────────┬───────────┬───────────┬───────────┬───┬──────────┬──────────┬───────────┬───────────┐
│ SOURCE_ID  ┆ 2mass     ┆ RA        ┆ DEC       ┆ … ┆ AV       ┆ EAV      ┆ DIST      ┆ EDIST     │
│ ---        ┆ ---       ┆ ---       ┆ ---       ┆   ┆ ---      ┆ ---      ┆ ---       ┆ ---       │
│ i64        ┆ binary    ┆ f64       ┆ f64       ┆   ┆ f64      ┆ f64      ┆ f64       ┆ f64       │
╞════════════╪═══════════╪═══════════╪═══════════╪═══╪══════════╪══════════╪═══════════╪═══════════╡
│ 2172342682 ┆ b&quot;2122173 ┆ 320.57220 ┆ 52.07734  ┆ … ┆ 1.157455 ┆ 0.199624 ┆ 655.30723 ┆ 30.59448  │
│ 494385024  ┆ 2+5204385 ┆ 4         ┆           ┆   ┆          ┆          ┆ 4         ┆           │
│            ┆ \x20&quot;     ┆           ┆           ┆   ┆          ┆          ┆           ┆           │
│ 2170224782 ┆ b&quot;2102364 ┆ 315.65202 ┆ 52.200351 ┆ … ┆ 1.157455 ┆ 0.199624 ┆ 655.30723 ┆ 30.59448  │
│ 576556672  ┆ 8+5212011 ┆ 9         ┆           ┆   ┆          ┆          ┆ 4         ┆           │
│            ┆ \x20&quot;     ┆           ┆           ┆   ┆          ┆          ┆           ┆           │
│ 2168760576 ┆ b&quot;2102519 ┆ 315.71659 ┆ 50.228894 ┆ … ┆ 1.157455 ┆ 0.199624 ┆ 655.30723 ┆ 30.59448  │
│ 695182208  ┆ 8+5013440 ┆ 9         ┆           ┆   ┆          ┆          ┆ 4         ┆           │
│            ┆ \x20&quot;     ┆           ┆           ┆   ┆          ┆          ┆           ┆           │
│ 2168760439 ┆ b&quot;2103032 ┆ 315.76355 ┆ 50.220269 ┆ … ┆ 1.157455 ┆ 0.199624 ┆ 655.30723 ┆ 30.59448  │
│ 256230528  ┆ 5+5013130 ┆ 5         ┆           ┆   ┆          ┆          ┆ 4         ┆           │
│            ┆ \x20&quot;     ┆           ┆           ┆   ┆          ┆          ┆           ┆           │
│ 2170222343 ┆ b&quot;2102193 ┆ 315.58060 ┆ 52.079478 ┆ … ┆ 1.157455 ┆ 0.199624 ┆ 655.30723 ┆ 30.59448  │
│ 035098880  ┆ 4+5204460 ┆ 2         ┆           ┆   ┆          ┆          ┆ 4         ┆           │
│            ┆ \x20&quot;     ┆           ┆           ┆   ┆          ┆          ┆           ┆           │
│ …          ┆ …         ┆ …         ┆ …         ┆ … ┆ …        ┆ …        ┆ …         ┆ …         │
│ 5333463286 ┆ b&quot;0111494 ┆ 17.956099 ┆ 70.956343 ┆ … ┆ 1.091624 ┆ 0.080364 ┆ 1165.7417 ┆ 39.611159 │
│ 99090432   ┆ 9+7057228 ┆           ┆           ┆   ┆          ┆          ┆ 21        ┆           │
│            ┆ \x20&quot;     ┆           ┆           ┆   ┆          ┆          ┆           ┆           │
│ 5330168188 ┆ b&quot;0103292 ┆ 15.871829 ┆ 70.148168 ┆ … ┆ 1.091624 ┆ 0.080364 ┆ 1165.7417 ┆ 39.611159 │
│ 09105792   ┆ 4+7008533 ┆           ┆           ┆   ┆          ┆          ┆ 21        ┆           │
│            ┆ \x20&quot;     ┆           ┆           ┆   ┆          ┆          ┆           ┆           │
│ 5328245073 ┆ b&quot;0107521 ┆ 16.967335 ┆ 69.863133 ┆ … ┆ 1.091624 ┆ 0.080364 ┆ 1165.7417 ┆ 39.611159 │
│ 52258560   ┆ 6+6951473 ┆           ┆           ┆   ┆          ┆          ┆ 21        ┆           │
│            ┆ \x20&quot;     ┆           ┆           ┆   ┆          ┆          ┆           ┆           │
│ 5324987770 ┆ b&quot;0122126 ┆ 20.552501 ┆ 70.076952 ┆ … ┆ 1.091624 ┆ 0.080364 ┆ 1165.7417 ┆ 39.611159 │
│ 32261120   ┆ 0+7004371 ┆           ┆           ┆   ┆          ┆          ┆ 21        ┆           │
│            ┆ \x20&quot;     ┆           ┆           ┆   ┆          ┆          ┆           ┆           │
│ 5356557841 ┆ b&quot;0118534 ┆ 19.72247  ┆ 73.35495  ┆ … ┆ 1.091624 ┆ 0.080364 ┆ 1165.7417 ┆ 39.611159 │
│ 51981696   ┆ 4+7321178 ┆           ┆           ┆   ┆          ┆          ┆ 21        ┆           │
│            ┆ \x20&quot;     ┆           ┆           ┆   ┆          ┆          ┆           ┆           │
└────────────┴───────────┴───────────┴───────────┴───┴──────────┴──────────┴───────────┴───────────┘
</pre></div>
</div>
</div>
</div>
<p>Note that the <code class="docutils literal notranslate"><span class="pre">2mass</span></code> column, a string column, has not been properly converted. This is a typical issue with FITS tables in which the Unicode strings are not properly handled. We can easily fix this and also show how to use the <code class="docutils literal notranslate"><span class="pre">.with_columns()</span></code> to create or replace columns by performing and operation on the existing columns. We’ll also use it to rename all the columns to lowercase:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">with_columns</span><span class="p">(</span><span class="n">polars</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s1">&#39;2mass&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">polars</span><span class="o">.</span><span class="n">String</span><span class="p">))</span>

<span class="c1"># Rename all columns to lowercase</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="k">lambda</span> <span class="n">col</span><span class="p">:</span> <span class="n">col</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>shape: (987_376, 18)
┌────────────┬───────────┬───────────┬───────────┬───┬──────────┬──────────┬───────────┬───────────┐
│ source_id  ┆ 2mass     ┆ ra        ┆ dec       ┆ … ┆ av       ┆ eav      ┆ dist      ┆ edist     │
│ ---        ┆ ---       ┆ ---       ┆ ---       ┆   ┆ ---      ┆ ---      ┆ ---       ┆ ---       │
│ i64        ┆ str       ┆ f64       ┆ f64       ┆   ┆ f64      ┆ f64      ┆ f64       ┆ f64       │
╞════════════╪═══════════╪═══════════╪═══════════╪═══╪══════════╪══════════╪═══════════╪═══════════╡
│ 2172342682 ┆ 21221732+ ┆ 320.57220 ┆ 52.07734  ┆ … ┆ 1.157455 ┆ 0.199624 ┆ 655.30723 ┆ 30.59448  │
│ 494385024  ┆ 5204385   ┆ 4         ┆           ┆   ┆          ┆          ┆ 4         ┆           │
│ 2170224782 ┆ 21023648+ ┆ 315.65202 ┆ 52.200351 ┆ … ┆ 1.157455 ┆ 0.199624 ┆ 655.30723 ┆ 30.59448  │
│ 576556672  ┆ 5212011   ┆ 9         ┆           ┆   ┆          ┆          ┆ 4         ┆           │
│ 2168760576 ┆ 21025198+ ┆ 315.71659 ┆ 50.228894 ┆ … ┆ 1.157455 ┆ 0.199624 ┆ 655.30723 ┆ 30.59448  │
│ 695182208  ┆ 5013440   ┆ 9         ┆           ┆   ┆          ┆          ┆ 4         ┆           │
│ 2168760439 ┆ 21030325+ ┆ 315.76355 ┆ 50.220269 ┆ … ┆ 1.157455 ┆ 0.199624 ┆ 655.30723 ┆ 30.59448  │
│ 256230528  ┆ 5013130   ┆ 5         ┆           ┆   ┆          ┆          ┆ 4         ┆           │
│ 2170222343 ┆ 21021934+ ┆ 315.58060 ┆ 52.079478 ┆ … ┆ 1.157455 ┆ 0.199624 ┆ 655.30723 ┆ 30.59448  │
│ 035098880  ┆ 5204460   ┆ 2         ┆           ┆   ┆          ┆          ┆ 4         ┆           │
│ …          ┆ …         ┆ …         ┆ …         ┆ … ┆ …        ┆ …        ┆ …         ┆ …         │
│ 5333463286 ┆ 01114949+ ┆ 17.956099 ┆ 70.956343 ┆ … ┆ 1.091624 ┆ 0.080364 ┆ 1165.7417 ┆ 39.611159 │
│ 99090432   ┆ 7057228   ┆           ┆           ┆   ┆          ┆          ┆ 21        ┆           │
│ 5330168188 ┆ 01032924+ ┆ 15.871829 ┆ 70.148168 ┆ … ┆ 1.091624 ┆ 0.080364 ┆ 1165.7417 ┆ 39.611159 │
│ 09105792   ┆ 7008533   ┆           ┆           ┆   ┆          ┆          ┆ 21        ┆           │
│ 5328245073 ┆ 01075216+ ┆ 16.967335 ┆ 69.863133 ┆ … ┆ 1.091624 ┆ 0.080364 ┆ 1165.7417 ┆ 39.611159 │
│ 52258560   ┆ 6951473   ┆           ┆           ┆   ┆          ┆          ┆ 21        ┆           │
│ 5324987770 ┆ 01221260+ ┆ 20.552501 ┆ 70.076952 ┆ … ┆ 1.091624 ┆ 0.080364 ┆ 1165.7417 ┆ 39.611159 │
│ 32261120   ┆ 7004371   ┆           ┆           ┆   ┆          ┆          ┆ 21        ┆           │
│ 5356557841 ┆ 01185344+ ┆ 19.72247  ┆ 73.35495  ┆ … ┆ 1.091624 ┆ 0.080364 ┆ 1165.7417 ┆ 39.611159 │
│ 51981696   ┆ 7321178   ┆           ┆           ┆   ┆          ┆          ┆ 21        ┆           │
└────────────┴───────────┴───────────┴───────────┴───┴──────────┴──────────┴───────────┴───────────┘
</pre></div>
</div>
</div>
</div>
<p>The expression inside <code class="docutils literal notranslate"><span class="pre">rename()</span></code> is called a <a class="reference external" href="https://docs.python.org/3/tutorial/controlflow.html#lambda-expressions" rel="noreferrer" target="_blank">lambda function</a> and is a way to define a function in a single line. In this case Polars will call it with the name of each column.</p>
<p>Let’s see what columns we have in the dataframe:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;source_id&#39;, &#39;2mass&#39;, &#39;ra&#39;, &#39;dec&#39;, &#39;parallax&#39;, &#39;id&#39;, &#39;g&#39;, &#39;bp&#39;, &#39;rp&#39;, &#39;j&#39;, &#39;h&#39;, &#39;k&#39;, &#39;age&#39;, &#39;eage&#39;, &#39;av&#39;, &#39;eav&#39;, &#39;dist&#39;, &#39;edist&#39;]
</pre></div>
</div>
</div>
</div>
<p>There are two columns that, in principle, should convey the same information: <code class="docutils literal notranslate"><span class="pre">parallax</span></code> is the <a class="reference external" href="https://en.wikipedia.org/wiki/Parallax" rel="noreferrer" target="_blank">stellar parallax</a> in milliarcseconds for the source, and <code class="docutils literal notranslate"><span class="pre">dist</span></code> is the distance to the star in parsecs. The distance can be calculated from the parallax using the formula:</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[
d = \frac{1}{p}
\]</div>
</div>
<p>where <span class="math notranslate nohighlight">\(d\)</span> is the distance in parsecs and <span class="math notranslate nohighlight">\(p\)</span> is the parallax in arcseconds. Let’s add two columns to our dataframe. The first one will be the distance calculated from the parallax (we’ll call it <code class="docutils literal notranslate"><span class="pre">dist_parallax</span></code>), and the second one will be the difference between <code class="docutils literal notranslate"><span class="pre">distance_parallax</span></code> and <code class="docutils literal notranslate"><span class="pre">dist</span></code> (we’ll call it <code class="docutils literal notranslate"><span class="pre">dist_diff</span></code>).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">with_columns</span><span class="p">(</span>
    <span class="n">dist_parallax</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">polars</span><span class="o">.</span><span class="n">col</span><span class="o">.</span><span class="n">parallax</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">))</span>
<span class="p">)</span><span class="o">.</span><span class="n">with_columns</span><span class="p">(</span>
    <span class="n">dist_diff</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">polars</span><span class="o">.</span><span class="n">col</span><span class="o">.</span><span class="n">dist_parallax</span> <span class="o">-</span> <span class="n">polars</span><span class="o">.</span><span class="n">col</span><span class="o">.</span><span class="n">dist</span><span class="p">)</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">polars</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s1">&#39;source_id&#39;</span><span class="p">,</span> <span class="s1">&#39;dist&#39;</span><span class="p">,</span> <span class="s1">&#39;parallax&#39;</span><span class="p">,</span> <span class="s1">&#39;dist_parallax&#39;</span><span class="p">,</span> <span class="s1">&#39;dist_diff&#39;</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>shape: (987_376, 5)
┌─────────────────────┬─────────────┬──────────┬───────────────┬────────────┐
│ source_id           ┆ dist        ┆ parallax ┆ dist_parallax ┆ dist_diff  │
│ ---                 ┆ ---         ┆ ---      ┆ ---           ┆ ---        │
│ i64                 ┆ f64         ┆ f32      ┆ f32           ┆ f64        │
╞═════════════════════╪═════════════╪══════════╪═══════════════╪════════════╡
│ 2172342682494385024 ┆ 655.307234  ┆ 1.682965 ┆ 594.189453    ┆ 61.117781  │
│ 2170224782576556672 ┆ 655.307234  ┆ 1.68418  ┆ 593.760742    ┆ 61.546492  │
│ 2168760576695182208 ┆ 655.307234  ┆ 1.699172 ┆ 588.52179     ┆ 66.785444  │
│ 2168760439256230528 ┆ 655.307234  ┆ 1.599939 ┆ 625.023987    ┆ 30.283247  │
│ 2170222343035098880 ┆ 655.307234  ┆ 1.909109 ┆ 523.804565    ┆ 131.502668 │
│ …                   ┆ …           ┆ …        ┆ …             ┆ …          │
│ 533346328699090432  ┆ 1165.741721 ┆ 0.644998 ┆ 1550.392578   ┆ 384.650857 │
│ 533016818809105792  ┆ 1165.741721 ┆ 0.923577 ┆ 1082.746948   ┆ 82.994773  │
│ 532824507352258560  ┆ 1165.741721 ┆ 0.669312 ┆ 1494.070557   ┆ 328.328836 │
│ 532498777032261120  ┆ 1165.741721 ┆ 0.80231  ┆ 1246.401611   ┆ 80.659891  │
│ 535655784151981696  ┆ 1165.741721 ┆ 0.658137 ┆ 1519.439697   ┆ 353.697976 │
└─────────────────────┴─────────────┴──────────┴───────────────┴────────────┘
</pre></div>
</div>
</div>
</div>
<p>We have used <code class="docutils literal notranslate"><span class="pre">with_columns()</span></code> twice to add the two columns since we need to use the value of the first column to calculate the second one. This is sometimes called <em>chaining</em> and is a common pattern in data science libraries.</p>
<p>Let’s now create a histogram of the distance difference.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;dist_diff&#39;</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Distance difference (pc)&#39;</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Number of stars&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/2a8709849595fde4bc9232f12c0a9181cd6ac4d1fbe53939d236c46fce0f97a9.png" src="../../_images/2a8709849595fde4bc9232f12c0a9181cd6ac4d1fbe53939d236c46fce0f97a9.png" />
</div>
</div>
<p>We see that a majority of the stars have a small distance difference but with a long tail. This tells us that the procedure used by the authors to calculate the distance took more than just the parallax into account.</p>
<p>We can also create an H-R diagram of the stars in the catalogue. The table includes the G, BP, and RP magnitudes for each star (these are all Gaia filters). For an H-R diagram we need to calculate the absolute magnitude of one of those filters (to act as a proxy for the luminosity). The effective temperature can be estimated from a colour (for example the difference between BP and RP). Since we know the distance, the absolute magnitude can be calculated from the apparent magnitude using the formula:</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[
M_G = m_G - 5 \cdot (log_{10}(d) - 1)
\]</div>
</div>
<p>where <span class="math notranslate nohighlight">\(M_G\)</span> is the absolute magnitude, <span class="math notranslate nohighlight">\(m_G\)</span> is the apparent G magnitude, and <span class="math notranslate nohighlight">\(d\)</span> is the distance in parsecs. We will use the <a class="reference external" href="https://seaborn.pydata.org/" rel="noreferrer" target="_blank">seaborn</a> library to create the H-R diagram using a histogram plot as we will see in more detail in the <a class="reference internal" href="../data_visualisation/data_visualisation.html#data-visualisation"><span class="std std-ref">next section</span></a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">seaborn</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">with_columns</span><span class="p">(</span>
    <span class="n">g_abs</span> <span class="o">=</span> <span class="n">polars</span><span class="o">.</span><span class="n">col</span><span class="o">.</span><span class="n">g</span> <span class="o">-</span> <span class="mi">5</span> <span class="o">*</span> <span class="p">(</span><span class="n">polars</span><span class="o">.</span><span class="n">col</span><span class="o">.</span><span class="n">dist</span><span class="o">.</span><span class="n">log10</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span>
    <span class="n">bp_rp</span> <span class="o">=</span> <span class="n">polars</span><span class="o">.</span><span class="n">col</span><span class="o">.</span><span class="n">bp</span> <span class="o">-</span> <span class="n">polars</span><span class="o">.</span><span class="n">col</span><span class="o">.</span><span class="n">rp</span>
<span class="p">)</span>

<span class="n">_</span> <span class="o">=</span> <span class="n">seaborn</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;bp_rp&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;g_abs&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>  <span class="c1"># Typically we want to invert the y-axis in H-R diagrams</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/94478c1eb78ccbe575fa0a0dfeb52cac2e1411cecd4f658ebd3352a96f0fe2ff.png" src="../../_images/94478c1eb78ccbe575fa0a0dfeb52cac2e1411cecd4f658ebd3352a96f0fe2ff.png" />
</div>
</div>
<p>We only see the main sequence here since all these stars are fairly young and most have not evolved to giants yet. In fact, we can sort this table by age (really the <span class="math notranslate nohighlight">\(\log_{10}\)</span> of the age in years):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="s1">&#39;age&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">polars</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s1">&#39;source_id&#39;</span><span class="p">,</span> <span class="s1">&#39;age&#39;</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>shape: (987_376, 2)
┌─────────────────────┬──────────┐
│ source_id           ┆ age      │
│ ---                 ┆ ---      │
│ i64                 ┆ f64      │
╞═════════════════════╪══════════╡
│ 5975543331278657408 ┆ 6.1192   │
│ 5975543335568508416 ┆ 6.1192   │
│ 5975462487104040448 ┆ 6.1192   │
│ 5975542579654256640 ┆ 6.1192   │
│ 5975518832773727360 ┆ 6.1192   │
│ …                   ┆ …        │
│ 533346328699090432  ┆ 9.776571 │
│ 533016818809105792  ┆ 9.776571 │
│ 532824507352258560  ┆ 9.776571 │
│ 532498777032261120  ┆ 9.776571 │
│ 535655784151981696  ┆ 9.776571 │
└─────────────────────┴──────────┘
</pre></div>
</div>
</div>
</div>
<p>Finally, lets save this dataframe as a Parquet file.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">write_parquet</span><span class="p">(</span><span class="s1">&#39;Kounkel_Clustering.parquet&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="working-with-time-series">
<h2>Working with time series<a class="headerlink" href="#working-with-time-series" title="Link to this heading">¶</a></h2>
<p>Let’s look at a third dataset, <code class="docutils literal notranslate"><span class="pre">daily-min-temperatures.csv</span></code>, which contains the daily minimum temperatures in Melbourne, Australia, from 1981 to 1990.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>head<span class="w"> </span>-20<span class="w"> </span>daily-min-temperatures.csv
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&quot;1981-01-19&quot;,17.7
</pre></div>
</div>
</div>
</div>
<p>We’ll start by loading with Polars and then convert the <code class="docutils literal notranslate"><span class="pre">Date</span></code> column to a datetime object.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">polars</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;daily-min-temperatures.csv&#39;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">with_columns</span><span class="p">(</span><span class="n">polars</span><span class="o">.</span><span class="n">col</span><span class="o">.</span><span class="n">Date</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>shape: (5, 2)
┌─────────────────────┬──────┐
│ Date                ┆ Temp │
│ ---                 ┆ ---  │
│ datetime[μs]        ┆ f64  │
╞═════════════════════╪══════╡
│ 1981-01-01 00:00:00 ┆ 20.7 │
│ 1981-01-02 00:00:00 ┆ 17.9 │
│ 1981-01-03 00:00:00 ┆ 18.8 │
│ 1981-01-04 00:00:00 ┆ 14.6 │
│ 1981-01-05 00:00:00 ┆ 15.8 │
└─────────────────────┴──────┘
</pre></div>
</div>
</div>
</div>
<p>We note a couple things: first, we have used the <code class="docutils literal notranslate"><span class="pre">.str</span></code> accessor to apply a function (<code class="docutils literal notranslate"><span class="pre">to_datetime()</span></code>) that only works on string columns; and when we use <code class="docutils literal notranslate"><span class="pre">with_columns()</span></code> but do not specify the name of the new column, Polars will use the name of the column we are modifying, overwriting it.</p>
<p>Noe that the <code class="docutils literal notranslate"><span class="pre">Date</span></code> column is a datetime object we have a real <em>time-series</em> dataset and we can use the <code class="docutils literal notranslate"><span class="pre">dt</span></code> accessor to apply functions that only work on datetime objects. To begin with, let’s just plot the data:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Temp&#39;</span><span class="p">])</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Date&#39;</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Temperature (C)&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/8c2ca2766c9e6ae9e17d5955e97ae14556e9c8bc6f55384f6fc5d6f68a99a0c3.png" src="../../_images/8c2ca2766c9e6ae9e17d5955e97ae14556e9c8bc6f55384f6fc5d6f68a99a0c3.png" />
</div>
</div>
<p>Th data shows a clear seasonal pattern, but also a lot of noise due to the day-to-day normal variations. We can use a <a class="reference external" href="https://en.wikipedia.org/wiki/Moving_average" rel="noreferrer" target="_blank">rolling mean</a> to smooth the data and see the seasonal pattern more clearly. A rolling mean is calculated by taking the mean of a number of consecutive values in the time series. For example, if we take a rolling mean of 7 days, we will take the mean of the first 7 days, then the mean of days 2 to 8, and so on. In this case we will average every 15 days.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">with_columns</span><span class="p">(</span><span class="n">min_mean</span><span class="o">=</span><span class="n">polars</span><span class="o">.</span><span class="n">col</span><span class="o">.</span><span class="n">Temp</span><span class="o">.</span><span class="n">rolling_mean_by</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span> <span class="n">window_size</span><span class="o">=</span><span class="s1">&#39;15d&#39;</span><span class="p">))</span>

<span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Temp&#39;</span><span class="p">],</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Daily min temp&#39;</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;min_mean&#39;</span><span class="p">],</span> <span class="s1">&#39;r-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;10-day rolling min mean&#39;</span><span class="p">)</span>

<span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Date&#39;</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Temperature (C)&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/7ca41dd95b178981a386b19e50e2aac20b2d08917d80efc764bcf2195e889652.png" src="../../_images/7ca41dd95b178981a386b19e50e2aac20b2d08917d80efc764bcf2195e889652.png" />
</div>
</div>
<p>The <a class="reference external" href="https://docs.pola.rs/api/python/stable/reference/expressions/api/polars.Expr.rolling_mean_by.html" rel="noreferrer" target="_blank">rolling_mean_by()</a> function is just one of many provided by Polars. You can check the documentation to understand how to use it.</p>
<p>This dataset contains repeated measurements for each day of the year for 10 years. We can use this to calculate the average temperature for each day of the year. This will help us introduce the concept of <em>grouping</em>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Add a column with the day of the year</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">with_columns</span><span class="p">(</span><span class="n">day_of_year</span><span class="o">=</span><span class="n">polars</span><span class="o">.</span><span class="n">col</span><span class="o">.</span><span class="n">Date</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">ordinal_day</span><span class="p">())</span>

<span class="c1"># Group data by day of the year and calculate the mean temperature.</span>
<span class="n">df_grouped</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">group_by</span><span class="p">(</span>
    <span class="n">polars</span><span class="o">.</span><span class="n">col</span><span class="o">.</span><span class="n">day_of_year</span>
<span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span>
    <span class="n">polars</span><span class="o">.</span><span class="n">col</span><span class="o">.</span><span class="n">Temp</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s1">&#39;daily_mean&#39;</span><span class="p">)</span>
<span class="p">)</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="s1">&#39;day_of_year&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">df_grouped</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>shape: (365, 2)
┌─────────────┬────────────┐
│ day_of_year ┆ daily_mean │
│ ---         ┆ ---        │
│ i16         ┆ f64        │
╞═════════════╪════════════╡
│ 1           ┆ 15.85      │
│ 2           ┆ 15.28      │
│ 3           ┆ 14.69      │
│ 4           ┆ 14.04      │
│ 5           ┆ 13.85      │
│ …           ┆ …          │
│ 361         ┆ 13.6       │
│ 362         ┆ 13.01      │
│ 363         ┆ 13.64      │
│ 364         ┆ 15.55      │
│ 365         ┆ 15.62      │
└─────────────┴────────────┘
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">group_by()</span></code> method creates groups of rows that share the same value for the group-by column. Then <code class="docutils literal notranslate"><span class="pre">agg()</span></code> applies the mean function to the <code class="docutils literal notranslate"><span class="pre">Temp</span></code> column for each group. The result is a new dataframe with the group-by columns and the aggregated columns. Let’s convert back from the day of the year to a date (with an arbitrary year) and plot the result:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Start by adding a column in which all the dates are the first day of the year 1980</span>
<span class="n">df_grouped</span> <span class="o">=</span> <span class="n">df_grouped</span><span class="o">.</span><span class="n">with_columns</span><span class="p">(</span><span class="n">date</span><span class="o">=</span><span class="n">polars</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="s1">&#39;1980-01-01&#39;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">polars</span><span class="o">.</span><span class="n">Date</span><span class="p">())</span> <span class="p">)</span>

<span class="c1"># Now add the day of the year as a time delta (minus one day since we start at 1)</span>
<span class="n">df_grouped</span> <span class="o">=</span> <span class="n">df_grouped</span><span class="o">.</span><span class="n">with_columns</span><span class="p">(</span>
    <span class="n">date</span><span class="o">=</span><span class="n">polars</span><span class="o">.</span><span class="n">col</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">polars</span><span class="o">.</span><span class="n">duration</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">polars</span><span class="o">.</span><span class="n">col</span><span class="o">.</span><span class="n">day_of_year</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df_grouped</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>shape: (365, 3)
┌─────────────┬────────────┬────────────┐
│ day_of_year ┆ daily_mean ┆ date       │
│ ---         ┆ ---        ┆ ---        │
│ i16         ┆ f64        ┆ date       │
╞═════════════╪════════════╪════════════╡
│ 1           ┆ 15.85      ┆ 1980-01-01 │
│ 2           ┆ 15.28      ┆ 1980-01-02 │
│ 3           ┆ 14.69      ┆ 1980-01-03 │
│ 4           ┆ 14.04      ┆ 1980-01-04 │
│ 5           ┆ 13.85      ┆ 1980-01-05 │
│ …           ┆ …          ┆ …          │
│ 361         ┆ 13.6       ┆ 1980-12-26 │
│ 362         ┆ 13.01      ┆ 1980-12-27 │
│ 363         ┆ 13.64      ┆ 1980-12-28 │
│ 364         ┆ 15.55      ┆ 1980-12-29 │
│ 365         ┆ 15.62      ┆ 1980-12-30 │
└─────────────┴────────────┴────────────┘
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_grouped</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">],</span> <span class="n">df_grouped</span><span class="p">[</span><span class="s1">&#39;daily_mean&#39;</span><span class="p">],</span> <span class="s1">&#39;r-&#39;</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Date&#39;</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Mean minimum temperature (C)&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/3d83d4ca24a7657abe69a450c1bf75d1deb7336b36a1dc2cb15daff76d7c910f.png" src="../../_images/3d83d4ca24a7657abe69a450c1bf75d1deb7336b36a1dc2cb15daff76d7c910f.png" />
</div>
</div>
</section>
<section id="relational-database-and-sql">
<h2>Relational database and SQL<a class="headerlink" href="#relational-database-and-sql" title="Link to this heading">¶</a></h2>
<p>Coming soon.</p>
</section>
<section id="further-reading">
<h2>Further reading<a class="headerlink" href="#further-reading" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://vita.had.co.nz/papers/tidy-data.pdf" rel="noreferrer" target="_blank">Tidy data</a> by Hadley Wickham</p></li>
<li><p><a class="reference external" href="https://ntrs.nasa.gov/api/citations/20080040136/downloads/20080040136.pdf" rel="noreferrer" target="_blank">Introduction to SQL</a></p></li>
</ul>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="../data_visualisation/data_visualisation.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Plotting and data visualisation</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="../photometry/photometry.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Photometry and CCD calibrations</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2025-, José Sánchez-Gallego
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            <div class="icons">
              <a class="muted-link " href="https://github.com/uw-astro-480/uw-astro-480.github.io/" aria-label="GitHub">
                <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"></path>
                </svg>
            </a>
              
            </div>
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Catalogue data and SQL</a><ul>
<li><a class="reference internal" href="#what-is-a-table">What is a table?</a><ul>
<li><a class="reference internal" href="#data-types">Data types</a></li>
<li><a class="reference internal" href="#tabular-data-formats">Tabular data formats</a></li>
</ul>
</li>
<li><a class="reference internal" href="#working-with-tabular-data">Working with tabular data</a></li>
<li><a class="reference internal" href="#reading-and-converting-fits-files">Reading and converting FITS files</a></li>
<li><a class="reference internal" href="#working-with-time-series">Working with time series</a></li>
<li><a class="reference internal" href="#relational-database-and-sql">Relational database and SQL</a></li>
<li><a class="reference internal" href="#further-reading">Further reading</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../../_static/documentation_options.js?v=01f34227"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/scripts/furo.js?v=5fa4622c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=df1a032d"></script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    </body>
</html>